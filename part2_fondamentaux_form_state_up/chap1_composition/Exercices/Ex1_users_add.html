<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Hello React</title>
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>

    <!-- permet de compiler le JSX -->
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
    <style>
        .heading{
            color: purple;
        }
    </style>
</head>
        <body>
        <div id="root"></div>
        <script type="text/babel">

        // Base de données
        const users = [
            { id : 1, name : "Alice" },
            { id : 2, name : "Alan"  },
            { id : 3, name : "Phil" },
            { id : 4, name : "Naoudi" },
            { id : 5, name : "Fenley" },
        ];

        class User extends React.Component {

            render() {

                return (
                    <li>id : {this.props.id} Name : {this.props.name}</li>
                );
            }
        }

        class Dashboard extends React.Component{

            render(){

                return (
                    <div className="dashboard">
                        <h1>Dashboard</h1>
                        {this.props.children}
                    </div>
                )
            }
            
        }

        class App extends React.Component{

            constructor(props) {
                super(props);
                this.state = { 
                    user: '', users : users, error : false
                    }
            }

            handleChange = (e) => {
                this.setState({ user : e.target.value, error : false });
                console.log(e.target.value)
            }

            handleClick = (e) => {

                const search = this.state.users.filter( user => user.name === this.state.user );

                if(search.length > 0){

                    this.setState({ error : true });

                    return;
                }

                // push avant car le push retourne le nombre d'élément se trouvant dans le tableau
                // mais il ne retourne pas le tableau
                this.state.users.push({ id : this.state.users.length + 1, name : this.state.user, error : false });
                this.setState({ users : this.state.users });
            }

            render(){

                return (
                    <Dashboard >
                        <input value={this.state.user} onChange={this.handleChange} />
                        <button onClick={this.handleClick}>
                                Add user
                        </button>
                        { this.state.error && <p>Attention l'utilisateur : {this.state.user} est déjà dans la liste </p> }
                        <ul>
                            {this.state.users.map((user, i) => (
                                <User key={i} {...user } />
                            ))}
                        </ul>
                    </Dashboard>
                );
            }
        }

        ReactDOM.render(
        <App />,
        document.getElementById('root')
        );

        </script>
</body>
</html>